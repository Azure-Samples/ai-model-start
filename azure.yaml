# yaml-language-server: $schema=https://raw.githubusercontent.com/Azure/azure-dev/main/schemas/v1.0/azure.yaml.json
name: foundry-models-starter
metadata:
  template: foundry-models-starter
infra:
  provider: bicep
  path: infra
hooks:
  postprovision:
    windows:
      shell: pwsh
      run: |
        Write-Host "Writing .env file..."
        $projectDir = if ($env:PROJECT_DIR) { $env:PROJECT_DIR } else { Get-Location }
        $envFile = Join-Path $projectDir ".env"
        $timestamp = (Get-Date).ToUniversalTime().ToString("yyyy-MM-ddTHH:mm:ssZ")
        $endpoint = azd env get-value AZURE_AI_PROJECT_ENDPOINT
        $model1 = azd env get-value AZURE_MODEL_DEPLOYMENT_NAME
        $model2 = azd env get-value AZURE_MODEL_2_DEPLOYMENT_NAME
        @(
          "# Auto-generated by azd - $timestamp"
          "AZURE_AI_PROJECT_ENDPOINT=$endpoint"
          "AZURE_MODEL_DEPLOYMENT_NAME=$model1"
          "AZURE_MODEL_2_DEPLOYMENT_NAME=$model2"
        ) | Set-Content -Path $envFile -Encoding utf8
        Write-Host ".env written successfully"
    posix:
      shell: sh
      run: |
        echo "Writing .env file..."
        envFile="${PROJECT_DIR:-.}/.env"
        echo "# Auto-generated by azd - $(date -u +%Y-%m-%dT%H:%M:%SZ)" > "$envFile"
        echo "AZURE_AI_PROJECT_ENDPOINT=$(azd env get-value AZURE_AI_PROJECT_ENDPOINT)" >> "$envFile"
        echo "AZURE_MODEL_DEPLOYMENT_NAME=$(azd env get-value AZURE_MODEL_DEPLOYMENT_NAME)" >> "$envFile"
        echo "AZURE_MODEL_2_DEPLOYMENT_NAME=$(azd env get-value AZURE_MODEL_2_DEPLOYMENT_NAME)" >> "$envFile"
        echo ".env written successfully"
